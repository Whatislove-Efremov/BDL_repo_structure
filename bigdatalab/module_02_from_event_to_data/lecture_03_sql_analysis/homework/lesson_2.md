# Урок 2: Операции обработки данных SQL

## Обзор
Этот урок посвящен операциям обработки данных SQL, включая DML (язык управления данными), DDL (язык определения данных), DCL (язык управления доступом) и расширенные операции с транзакциями.

## Цели обучения
Студенты будут практиковать:
- Операции DML: INSERT, UPDATE, DELETE
- Операции DDL: CREATE, ALTER, DROP таблиц и ограничений
- Операции DCL: GRANT, REVOKE разрешений
- Управление транзакциями
- Расширенные операции DML с функциями и представлениями
- Расширенные аналитические операции

## Задания
Выполните следующие SQL-упражнения, используя набор данных EcoMarket:

### Часть 1: Операции DML
- Вставить два новых продукта в таблицу Products
- Выбрать продукты, где is_allergic = 'Yes' и vitality_days > 0
- Обновить is_allergic для 'Bananas Family Pack' на 'Yes'
- Удалить один из добавленных продуктов
- Проверить все изменения с помощью SELECT * FROM Products

### Часть 2: Операции DDL
- Создать новую таблицу с именем Data_Layers со столбцами: LayerID (SERIAL, PRIMARY KEY), LayerName (VARCHAR(50), UNIQUE, NOT NULL), Description (TEXT)
- Заполнить столбец LayerName тремя значениями: 'Bronze', 'Silver', 'Gold'
- Добавить столбец manager_email в таблицу Data_Layers (VARCHAR(100))
- Добавить ограничение UNIQUE к столбцу manager_email в таблице shops
- Переименовать столбец address в таблице Shops в shop_address

### Часть 3: Операции DCL
- Создать новую роль PostgreSQL с именем data_engineer_trainee с простым паролем
- Предоставить роли data_engineer_trainee разрешение SELECT на таблицу Sales
- Протестировать как data_engineer_trainee, пытаясь выполнить SELECT из Sales (должно работать)
- Попытаться выполнить INSERT новой продажи как data_engineer_trainee (должно завершиться ошибкой)
- Как администратор, предоставить разрешения INSERT и UPDATE на Sales для data_engineer_trainee
- Протестировать INSERT и UPDATE как data_engineer_trainee (теперь должно работать)

### Часть 4: Расширенные операции DML с транзакциями
- Увеличить цену всех продуктов в категории 'Dairy' на 10%
- Удалить всех сотрудников без каких-либо продаж
- Вставить нового сотрудника и его первую продажу в одной транзакции

### Часть 5: Функции и представления для Gold Layer
- Создать функцию AvgSalesPerEmployee (PL/pgSQL) для вычисления средних продаж для сотрудника
- Создать представление FullStatShops для агрегированных статистик магазинов со столбцами (shop_id, shop_address, country, total_sales_count, total_sales_amount)

### Часть 6: Расширенные операции DML
- Найти сотрудников с продажами > 1000
- Обновить классификацию продукта на 'A' для категорий с общей выручкой > 5000
- Установить modify_timestamp для продуктов без дат